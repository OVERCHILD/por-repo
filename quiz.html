<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Page</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .user-info {
            position: absolute;
            top: 10px;
            left: 10px;
            text-align: left;
            color: white;
        }

        .user-info span {
            display: block;
        }

        .user-info .status-blink {
            animation: status-blink-animation 2s infinite;
        }

        @keyframes status-blink-animation {
            0% {
                color: green;
            }
            50% {
                color: white;
            }
            100% {
                color: green;
            }
        }

        .user-info .offline {
            color: red;
        }

        .logout-button {
            margin-top: 5px;
            padding: 5px 10px;
            background-color: #FF5733; /* ‡∏™‡∏µ‡∏™‡πâ‡∏° */
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .logout-button:hover {
            background-color: #C70039; /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏° */
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <div class="user-info">
            <span id="username-display"></span>
            <span id="user-status" class="status-blink">Online</span>
            <button class="logout-button" onclick="logout()">Logout</button>
        </div>
        <div class="score-container">
            <p id="score-text">Score: <span id="score">0</span> (Highest: <span id="highest-score">0</span>)</p>
        </div>
        <div id="question-container" class="question-container"></div>
        <div class="button-container">
            <button id="confirm-button" class="btn bold-blink" onclick="checkAnswer()">Confirm Answer</button>
            <button id="next-button" class="btn bold-blink" onclick="loadNextQuestionWithDelay()" style="display: none;">Next Question</button>
        </div>
        <p id="result-message" class="result-message">Please select an answer.</p>
        <p id="warning-message" class="warning-message" style="display: none;">Your browser doesn't support text-to-speech. Please use a different browser.</p>
    </div>

    <audio id="correct-sound" src="path/audiofiles/correct.mp3"></audio>
    <audio id="wrong-sound" src="path/audiofiles/wrong.mp3"></audio>
    <audio id="next-sound" src="path/audiofiles/next.mp3"></audio>

    <script src="questions.js"></script>
    <script>
        // Check if the user is logged in
        const currentUser = localStorage.getItem('currentUser');
        if (!currentUser) {
            alert('Please log in first.');
            location.href = 'index.html';
        } else {
            document.getElementById('username-display').textContent = currentUser;
        }

        // Retrieve and display the highest score
        const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
        const currentUserData = registeredUsers.find(user => user.username === currentUser);
        let highestScore = currentUserData ? currentUserData.highestScore || 0 : 0;
        document.getElementById('highest-score').textContent = highestScore;

        function logout() {
            localStorage.removeItem('currentUser');
            location.href = 'index.html';
        }

        function updateOnlineStatus() {
            const statusElement = document.getElementById('user-status');
            if (navigator.onLine) {
                statusElement.textContent = 'Online';
                statusElement.classList.remove('offline');
                statusElement.classList.add('status-blink');
            } else {
                statusElement.textContent = 'Offline';
                statusElement.classList.remove('status-blink');
                statusElement.classList.add('offline');
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        updateOnlineStatus(); // Update status on page load

        let questionsList = [...questions]; // ‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        let currentQuestionIndex = 0;
        let score = 0;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function loadQuestion(questionIndex) {
            const questionContainer = document.getElementById('question-container');
            const question = questionsList[questionIndex];

            let html = `<p class="question-text">${question.question} 
                <button class="speaker-button" onclick="speakQuestion('${question.question}')">
                    üîä
                </button>
            </p>`;

            const shuffledOptions = shuffleArray([...question.options]);

            shuffledOptions.forEach((option, index) => {
                html += `
                    <input type="radio" id="option${index}" name="options" value="${option}">
                    <label for="option${index}" class="option-label" onclick="speakOption('${option}')">${option}</label><br>
                `;
            });

            questionContainer.innerHTML = html;

            const optionLabels = document.querySelectorAll('.option-label');
            optionLabels.forEach(label => {
                label.addEventListener('click', () => {
                    optionLabels.forEach(l => l.classList.remove('selected'));
                    label.classList.add('selected');
                });
            });
        }

        
        function speakQuestion(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                window.speechSynthesis.speak(utterance);
            } else {
                showWarningMessage();
            }
        }

        function speakOption(option) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(option);
                utterance.lang = 'en-US';
                window.speechSynthesis.speak(utterance);
            } else {
                showWarningMessage();
            }
        }

        function showWarningMessage() {
            const warningMessage = document.getElementById('warning-message');
            warningMessage.style.display = 'block';
        }

        function checkAnswer() {
            const selectedOption = document.querySelector('input[name="options"]:checked');
            const resultMessage = document.getElementById('result-message');
            const confirmButton = document.getElementById('confirm-button');
            const nextButton = document.getElementById('next-button');
            const scoreDisplay = document.getElementById('score');
            const scoreText = document.getElementById('score-text');
            const correctSound = document.getElementById('correct-sound');
            const wrongSound = document.getElementById('wrong-sound');
            
            if (selectedOption) {
                const answer = selectedOption.value;
                const selectedLabel = selectedOption.nextElementSibling; // ‡πÅ‡∏ó‡πá‡∏Å <label> ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                if (answer === questionsList[currentQuestionIndex].correctAnswer) {
                    resultMessage.textContent = "Correct!";
                    resultMessage.style.color = "green";
                    score++;
                    scoreDisplay.textContent = score;
                    scoreText.classList.add('score-blink'); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏•‡∏≤‡∏™‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö Score: ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                    setTimeout(() => {
                        scoreText.classList.remove('score-blink'); // ‡∏•‡∏ö‡∏Ñ‡∏•‡∏≤‡∏™‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö
                    }, 2000); // ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                    correctSound.play();
                    selectedLabel.style.backgroundColor = "#a0d2eb"; // ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô
                    selectedLabel.style.color = "black"; // ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
                    if (score > highestScore) {
                        highestScore = score;
                        document.getElementById('highest-score').textContent = highestScore;
                        currentUserData.highestScore = highestScore;
                        localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                    }
                } else {
                    resultMessage.textContent = "Wrong!";
                    resultMessage.style.color = "red";
                    wrongSound.play();
                    selectedLabel.style.backgroundColor = "#ffcc80"; // ‡∏™‡∏µ‡∏™‡πâ‡∏°
                    selectedLabel.style.color = "black"; // ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠
                }
                confirmButton.style.display = "none";
                nextButton.style.display = "block";
                nextButton.classList.add('bold-blink'); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏•‡∏≤‡∏™‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° Next Question
            } else {
                resultMessage.textContent = "Please select an answer.";
                resultMessage.style.color = "orange";
                // ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á
                resultMessage.classList.add('blink');
                speakWarningMessage(resultMessage.textContent);
                setTimeout(() => {
                    resultMessage.classList.remove('blink');
                }, 2000); // ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            }
        }

        function speakWarningMessage(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                window.speechSynthesis.speak(utterance);
            } else {
                showWarningMessage();
            }
        }

        function loadNextQuestion() {
            const resultMessage = document.getElementById('result-message');
            const confirmButton = document.getElementById('confirm-button');
            const nextButton = document.getElementById('next-button');
            const questionContainer = document.getElementById('question-container');

            resultMessage.textContent = "Please select an answer.";
            resultMessage.style.color = "orange";
            confirmButton.style.display = "block";
            nextButton.style.display = "none";
            nextButton.classList.remove('bold-blink'); // ‡∏•‡∏ö‡∏Ñ‡∏•‡∏≤‡∏™‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
            currentQuestionIndex++;
            if (currentQuestionIndex < questionsList.length) {
                loadQuestion(currentQuestionIndex);
            } else {
                resultMessage.textContent = "You've completed all questions!";
                resultMessage.style.color = "blue";
                confirmButton.style.display = "none";
                nextButton.style.display = "none";
            }
        }

        function loadNextQuestionWithDelay() {
            const nextSound = document.getElementById('next-sound');
            nextSound.volume = 0.3; // ‡∏•‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 30%
            nextSound.play();
            setTimeout(loadNextQuestion, 1000); // ‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡πå 1.0 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        }

        document.addEventListener('DOMContentLoaded', function() {
            questionsList = shuffleArray(questionsList); // ‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
            loadQuestion(currentQuestionIndex);
        });
    </script>
</body>
</html>
